import it.bitrule.plorex.script.ASpotlessPlugin
import it.bitrule.plorex.script.CommonPlugin
import it.bitrule.plorex.script.PublishPlugin

plugins {
    id 'java'
    id 'maven-publish'
    id 'idea'
    alias libs.plugins.shadow
}

apply plugin: "java"
apply plugin: ASpotlessPlugin
apply plugin: PublishPlugin
apply plugin: CommonPlugin

repositories {
    mavenLocal()

    maven {
        name "opencollab-releases"
        url "https://repo.opencollab.dev/maven-releases/"
    }

    maven {
        name "opencollab-snapshots"
        url "https://repo.opencollab.dev/maven-snapshots/"
    }
}

dependencies {
    implementation "com.sparkjava:spark-core:2.9.4"
    implementation "org.cloudburstmc.protocol:common:3.0.0.Beta2-SNAPSHOT"
    implementation libs.miwiklark.get()
    implementation libs.mongodb.get()
    implementation libs.jedis.get()
    compileOnly libs.gson.get()

    compileOnly libs.annotations.get()
    compileOnly libs.lombok.get()
    annotationProcessor libs.lombok.get()

    testCompileOnly libs.lombok.get()
    testAnnotationProcessor libs.lombok.get()
}

tasks {
    build {
        dependsOn spotlessApply
        dependsOn shadowJar
    }

    shadowJar {
        archiveFileName.set("${rootProject.name}-${version}.jar")
    }

    jar {
        manifest {
            attributes["Main-Class"] = "it.bitrule.rubudu.Loader"
        }
    }

    compileJava {
        options.encoding = "UTF-8"
        options.compilerArgs.add("-Xpkginfo:always")
    }
}

//Automatically download dependencies source code
idea {
    module {
        downloadSources = true
        downloadJavadoc = false
    }
}

tasks.withType(AbstractCopyTask).configureEach {
    duplicatesStrategy = DuplicatesStrategy.INCLUDE
}

java {
    withSourcesJar()
}
